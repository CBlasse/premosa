<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>PreMosa by PreMosa</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
				<img src="./images/PreMosaLogo.png" alt="PreMosa" ><br>
				<p align="center">Mosaic Preprocessing Pipeline</p>
        <ul>
          <li><a href="https://github.com/CBlasse/premosa/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/CBlasse/premosa/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/CBlasse/premosa">View On <strong>GitHub</strong></a></li>
        </ul>
        <p class="view"><a href="https://github.com/CBlasse/premosa">View the Project on GitHub <small>CBlasse/premosa</small></a></p>
				
				<p  style="margin-top:5em;"><h3>Navigation</h3></p>
				<p  style="margin-left:2em;">
					<a href="index.html">1. Introduction</a><br>
					<a href="installation.html">2. Installation</a><br>
					<a href="usage.html">3. Usage</a><br>
					<a href="example.html">4. Example</a>
				</p>
      </header>
      <section>
        <h1>
<a id="welcome-to-premosa" class="anchor" href="#welcome-to-premosa" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h1>

<p><font style='font-variant:small-caps;'>PreMosa</font> is a pipeline designed to preprocess 3D image mosaics of one or several time points fully automatically and without any interaction. In case further customization is needed, the individual programs are also provided. </p>
A data example can be downloaded <a href="https://cloud.mpi-cbg.de/index.php/s/4VkbGTKp65S9o0T">here</a>.<br><br>

<h3>
<a id="usage-pipeline" class="anchor" href="#usage-pipeline" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mosaic Preprocessing Pipeline <font style='font-variant:small-caps;'>PreMosa</font></h3>
<p>The pipeline automatically performs all processing tasks independently whether the methods are provided as C++ programs or Fiji plugins. To run <font style='font-variant:small-caps;'>PreMosa</font>, one needs to use the following command:<br><br>
<span style="background-color: #f4f4f4;padding-left:30px;padding-right:20px;padding-bottom:10px;padding-top:10px">./PreMosa <em>parameter.xml</em></span><br><br>	
The xml file contains all required and optional parameter:</p>
<img src="./images/XMLParameter.png"  alt="XML Parameter">
<table>
  <tr  style="border-bottom:2px solid #e5e5e5;">
    <td width=150px><em>Required parameter</em></td>
		<td><em>Description</em></td>
  </tr>
  <tr>
    <td>&lt;folderNameExpression&gt;</td>
		<td>Template of the subfolders names: {iii} encodes the time point </td>
  </tr>
  <tr>
    <td>&lt;fileNameExpression&gt;</td>
		<td>Template of the input images: {iii} encodes the tile number, TIME the time </td>
  </tr>
  <tr>
    <td>&lt;tStart&gt;</td>
		<td>First time point</td>
  </tr>
  <tr>
    <td>&lt;tEnd&gt;</td>
		<td>Last time point</td>
  </tr>
  <tr>
    <td>&lt;fiji&gt;</td>
		<td>Path to the Fiji application including the option to use Java 8 (To activate Java 8 look <a href=https://imagej.net/Frequently_Asked_Questions#How_do_I_launch_ImageJ_with_a_different_version_of_Java.3F>here</a>)</td>
  </tr>
  <tr>
    <td>&lt;scriptLocation&gt;</td>
		<td>Path to the Fiji scripts required for PreMosa</td>
  </tr>
  <tr>
    <td>&lt;tileNumber&gt;</td>
		<td>Number of tiles</td>
  </tr>
  <tr>
    <td>&lt;gridSizeX&gt;</td>
		<td>Number of tiles in X direction</td>
  </tr>
  <tr>
    <td>&lt;gridSizeY&gt;</td>
		<td>Number of tiles in Y direction</td>
  </tr>
  <tr>
    <td>&lt;firstIndex&gt;</td>
		<td>Index of the first tile</td>
  </tr>
  <tr>
    <td>&lt;outputFolder&gt;</td>
		<td>Output folder</td>
  </tr>
  <tr  style="border-bottom:2px solid #e5e5e5;border-top:2px solid #e5e5e5;">
    <td width=150px><em>Optional parameter</em></td>
		<td><em>Description</em></td>
  </tr>
  <tr>
    <td>&lt;verbose&gt;</td>
		<td>Activation/Deactivation of printing of preprocessing statuses</td>
  </tr>
  <tr>
    <td>&lt;intermediateFileDeletion&gt;</td>
		<td>Activation/Deactivation of deletion of all files created during the preprocessing</td>
  </tr>
  <tr>
    <td>&lt;radius&gt;</td>
		<td>Grid size (Surface Extraction)</td>
  </tr>
  <tr>
    <td>&lt;distance&gt;</td>
		<td>Distance parameter (Surface Extraction)</td>
  </tr>
  <tr>
    <td>&lt;threshold&gt;</td>
		<td>Number of bright pixels (Surface Extraction)</td>
  </tr>
  <tr>
    <td>&lt;printHeightMap&gt;</td>
		<td>Activation/Deactivation of export of the height map (Surface Extraction)</td>
  </tr>
  <tr>
    <td>&lt;overlap&gt;</td>
		<td>Percentage of overlap of the mosaic tiles (Stitching)</td>
  </tr>
  <tr>
    <td>&lt;masterTileConfig&gt;</td>
		<td>File with fixed stitching coordinates (Stitching)</td>
  </tr>
  <tr>
    <td>&lt;flatField&gt;</td>
		<td>Path to a precomputed flat field image (Flat field correction)</td>
  </tr>
  <tr>
    <td>&lt;minIntensity&gt;</td>
		<td>Minimum intensity accepted for the sampled pixel pairs (Contrast adjustment)</td>
  </tr>
  <tr>
    <td>&lt;maxIntensity&gt;</td>
		<td>Maximum intensity accepted for the sampled pixel pairs (Contrast adjustment)</td>
  </tr>
  <tr>
    <td>&lt;numberOfPixelPairs&gt;</td>
		<td>Number of sampled pixel pairs (Contrast adjustment)</td>
  </tr>
  <tr>
    <td>&lt;lambda1&gt;</td>
		<td>Penalties for the integrated regularizer (Contrast adjustment)</td>
  </tr>
  <tr>
    <td>&lt;lambda2&gt;</td>
		<td>Penalties for the integrated regularizer (Contrast adjustment)</td>
  </tr>
	
</table>
<h3>
<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Surface extraction</h3>
<p>
The provided 2D projection extracts one (or several) surface(s) within the 3D image volume and projects it onto a 2D image. 
</p>
<span style="background-color: #f4f4f4;padding-left:20px;padding-right:30px;padding-bottom:30px;padding-top:10px">./SurfaceExtraction [-r &lt;int&gt;] [-d &lt;int&gt;] [-l &lt;int&gt;] [-t &lt;int&gt;] [-hmd] [-hmr] [-mi] -in <em>inputImage.tif</em></span><br><span style="padding-left:100px">-out <em>outputImage.tif</em></span><br><br>
<p>Optional parameters are indicated with square brackets. If they are not be considered or default values are used, then one simply ignores them in the command.</p>
<table>
  <tr  style="border-bottom:2px solid #e5e5e5;">
    <td width=150px><em>Required parameter</em></td>
		<td><em>Description</em></td>
  </tr>
  <tr>
    <td>inputImage.tif</td>
		<td>3D input image (8-bit/16-bit)</td>
  </tr>
  <tr>
    <td>outputImage.tif</td>
		<td>2D output image </td>
  </tr>
  <tr  style="border-bottom:2px solid #e5e5e5;border-top:2px solid #e5e5e5;">
    <td width=150px><em>Optional parameter</em></td>
		<td><em>Description</em></td>
  </tr>
	<tr>
		<td>-r &lt;int&gt;</td>
		<td>Initial grid size (default: -r 20)</td>	
	</tr>
	<tr>
		<td>-d &lt;int&gt;</td>
		<td>Distance parameter, defines the size of the substacks of the second selection (default: -d 2)</td>	
	</tr>
	<tr>
		<td>-l &lt;int&gt;</td>
		<td>Number of signal layers present in the volume (default: -l 1)</td>	
	</tr>
	<tr>
		<td>-t &lt;int&gt;</td>
		<td>Indication of the number of bright pixels (default: -t 50)</td>	
	</tr>
	<tr>
		<td>-hmd</td>
		<td>Activation/Deactivation of exporting the down-sampled height map</td>	
	</tr>
	<tr>
		<td>-hmr</td>
		<td>Activation/Deactivation of exporting the height map</td>	
	</tr>
	<tr>
		<td>-mi</td>
		<td>Activation/Deactivation of a projection that projects the maximal intensities of the detected layer and its neighboring ones</td>	
	</tr>
</table>


<h3>
<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Extended surface extraction</h3>
<p>For multi-channel image volumes, there is the possibility of using a computed heigh map to project a spatially close surface. This extension is especially useful, when a surface is challenging or feature sparse signals. </p><br>
<span style="background-color: #f4f4f4;padding-left:20px;padding-right:30px;padding-bottom:30px;padding-top:10px">./ExtendedSurfaceExtraction [-r &lt;int&gt;] [-d1 &lt;int&gt;] [-d2 &lt;int&gt;] [-t &lt;int&gt;] [-hmd] [-hmr] [-mi] </span><br><span style="padding-left:100px">-in <em>inputImage.tif</em> -hmFile <em>heightMap.tif</em> -out <em>outputImage.tif</em></span><br><br>
Optional parameters are indicated with square brackets. If they are not be considered or default values are used, then one simply ignores them in the command.
<table>
  <tr  style="border-bottom:2px solid #e5e5e5;">
    <td width=150px><em>Required parameter</em></td>
		<td><em>Description</em></td>
  </tr>
  <tr>
    <td>inputImage.tif</td>
		<td>3D input image (8-bit/16-bit)</td>
  </tr>
  <tr>
    <td>heightMap.tif</td>
		<td>Given height map (32-bit)</td>
  </tr>
  <tr>
    <td>outputImage.tif</td>
		<td>2D output image </td>
  </tr>
  <tr  style="border-bottom:2px solid #e5e5e5;border-top:2px solid #e5e5e5;">
    <td width=150px><em>Optional parameter</em></td>
		<td><em>Description</em></td>
  </tr>
	<tr>
		<td>-r &lt;int&gt;</td>
		<td>Initial grid size (default: -r 20)</td>	
	</tr>
	<tr>
		<td>-d1 &lt;int&gt;</td>
		<td>Offset parameter, defines the minimal offset of the target surface to the given height map. The offset parameter d1 needs to be smaller than d2. (default: -d2 0)</td>	
	</tr>
	<tr>
		<td>-d2 &lt;int&gt;</td>
		<td>Offset parameter, defines the maximal offset of the target surface to the given height map. The offset parameter d1 needs to be smaller than d2. (default: -d2 0)</td>	
	</tr>
	<tr>
		<td>-l &lt;int&gt;</td>
		<td>Number of signal layers present in the volume (default: -l 1)</td>	
	</tr>
	<tr>
		<td>-t &lt;int&gt;</td>
		<td>Indication of the number of bright pixels (default: -t 50)</td>	
	</tr>
	<tr>
		<td>-hmd</td>
		<td>Activation/Deactivation of exporting the down-sampled height map</td>	
	</tr>
	<tr>
		<td>-hmr</td>
		<td>Activation/Deactivation of exporting the height map</td>	
	</tr>
	<tr>
		<td>-mi</td>
		<td>Activation/Deactivation of a projection that projects the maximal intensities of the detected layer and its neighboring ones</td>	
	</tr>
</table>


<h3>
<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Flat field correction</h3>
<p>The flat field correction removes uneven illumination in 2D images (8-bit, 16-bit) using a flat field with was either provided as an input or generated from the input image. The usage is the following:
<br><br>
<span style="background-color: #f4f4f4;padding-left:20px;padding-right:30px;padding-bottom:10px;padding-top:10px">./FlatFieldCorrection -in <em>inputImage.tif</em> [-ff <em>flatFieldImage.tif</em>] -out <em>outputImage.tif</em></span><br><br>
Whereas the input and output image (-in, -out) are required parameters, the flat field image (-ff) can be optionally specified.</p>

<h3>
<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mosaic stitching</h3>
<p>To stitch the image mosaic, we apply the Fiji plugin <em>Grid Stitching</em>, which allows one to merge the tiles using the information about the layout or a predefined coordinates for each tile. </p>

<h3>
<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contrast Adjustment</h3>
<p>To adjust the contrast and brightness of individual tiles in a mosaic, we provide a Fiji plugin. The .jar file can be found in the FijiScripts folder of our repository. Alternatively, one can also compile the code from the <a href=https://github.com/CBlasse/MosaicContrastAdjustment.git>MosaicContrastAdjustment plugin</a>.
	<img src="./images/ContrastAdjustment.png" alt="ContrastAdjustment plugin" ><br>
	 This plugin requires the following parameter:</p>
<table>
  <tr  style="border-bottom:2px solid #e5e5e5;">
    <td width=150px><em>Parameter</em></td>
		<td><em>Description</em></td>
  </tr>
  <tr>
    <td>Folder</td>
		<td>Folder with all image tiles (slash at the end of the path is required)</td>
  </tr>
  <tr>
    <td>Output Folder</td>
		<td>Folder for all corrected images (slash at the end of the path is required)</td>
  </tr>
  <tr>
    <td>Tile Configuration</td>
		<td>File with the position of each image tile, generated using the <em>Grid Stitching</em> plugin</td>
  </tr>
	<tr>
    <td>Minimum / Maximum intensity</td>
		<td>Definition of the intensity range accepted for the sampled pixel pairs</td>
  </tr>
	<tr>
    <td>Number of samples</td>
		<td>Number of sampled pixel pairs</td>
  </tr>
	<tr>
    <td>Lambda 1 / Lambda 2</td>
		<td>Penalties for the integrated regularizer (The higher, the bigger the possible divergence from the original images)</td>
  </tr>
</table>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/CBlasse">CBlasse</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
